#!/bin/bash
#
# Claude Docker Information Display
# Shows comprehensive system information
#

set -e

# Colors
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
CYAN='\033[0;36m'
MAGENTA='\033[0;35m'
NC='\033[0m'

echo -e "${CYAN}"
cat << 'LOGO'
   ________                __        ____             __            
  / ____/ /___ ___  ______/ /__     / __ \____  _____/ /_____  _____
 / /   / / __ `/ / / / __  / _ \   / / / / __ \/ ___/ //_/ _ \/ ___/
/ /___/ / /_/ / /_/ / /_/ /  __/  / /_/ / /_/ / /__/ ,< /  __/ /    
\____/_/\__,_/\__,_/\__,_/\___/  /_____/\____/\___/_/|_|\___/_/     
LOGO
echo -e "${NC}"

# Version
VERSION=$(grep "VERSION=" /usr/local/bin/claude-dev 2>/dev/null | head -1 | cut -d'"' -f2 || echo "unknown")
echo -e "${BLUE}Version:${NC} $VERSION"
echo ""

# System Info
echo -e "${MAGENTA}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${NC}"
echo -e "${CYAN}System Information${NC}"
echo -e "${MAGENTA}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${NC}"
echo ""

# Docker
docker_version=$(docker --version 2>/dev/null | cut -d' ' -f3 | tr -d ',' || echo "not found")
echo -e "  Docker:        ${GREEN}$docker_version${NC}"

# Available Images
dev_available=$(docker images andreashurst/claude-docker:latest-dev --format "{{.Size}}" 2>/dev/null || echo "not pulled")
flow_available=$(docker images andreashurst/claude-docker:latest-flow --format "{{.Size}}" 2>/dev/null || echo "not pulled")
echo -e "  Dev Image:     ${GREEN}$dev_available${NC}"
echo -e "  Flow Image:    ${GREEN}$flow_available${NC}"

echo ""

# Commands
echo -e "${MAGENTA}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${NC}"
echo -e "${CYAN}Available Commands${NC}"
echo -e "${MAGENTA}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${NC}"
echo ""

commands=(
    "claude-dev:Start dev environment"
    "claude-flow:Start flow environment"
    "claude-health:Check container status"
    "claude-update:Check for updates"
    "claude-info:Show this information"
    "docker-image-report:Analyze image sizes"
    "make:Run common tasks"
)

for cmd in "${commands[@]}"; do
    name=${cmd%%:*}
    desc=${cmd#*:}
    if command -v $name &> /dev/null; then
        echo -e "  ${GREEN}✓${NC} ${YELLOW}$name${NC} - $desc"
    else
        echo -e "  ${RED}✗${NC} ${YELLOW}$name${NC} - $desc"
    fi
done

echo ""

# Container Status
echo -e "${MAGENTA}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${NC}"
echo -e "${CYAN}Container Status${NC}"
echo -e "${MAGENTA}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${NC}"
echo ""

check_container() {
    local name=$1
    if docker ps --filter "name=$name" --format "{{.Names}}" 2>/dev/null | grep -q "$name"; then
        local status=$(docker inspect --format='{{.State.Status}}' $name 2>/dev/null)
        echo -e "  ${GREEN}✓${NC} $name: ${GREEN}$status${NC}"
    else
        echo -e "  ${YELLOW}○${NC} $name: ${YELLOW}not running${NC}"
    fi
}

check_container "claude-dev"
check_container "claude-flow"

echo ""

# Quick Start
echo -e "${MAGENTA}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${NC}"
echo -e "${CYAN}Quick Start${NC}"
echo -e "${MAGENTA}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${NC}"
echo ""
echo -e "  ${YELLOW}claude-dev${NC}              Start development environment"
echo -e "  ${YELLOW}claude-flow${NC}             Start testing environment"
echo -e "  ${YELLOW}claude-health${NC}           Check health status"
echo -e "  ${YELLOW}claude-update --check${NC}   Check for updates"
echo -e "  ${YELLOW}make help${NC}               Show all make commands"
echo ""

# Resources
echo -e "${MAGENTA}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${NC}"
echo -e "${CYAN}Resources${NC}"
echo -e "${MAGENTA}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${NC}"
echo ""
echo -e "  📖 Documentation: ${BLUE}https://github.com/andreashurst/claude-docker${NC}"
echo -e "  🐛 Report Issue:  ${BLUE}https://github.com/andreashurst/claude-docker/issues${NC}"
echo -e "  💬 Discussions:   ${BLUE}https://github.com/andreashurst/claude-docker/discussions${NC}"
echo -e "  🐳 Docker Hub:    ${BLUE}https://hub.docker.com/r/andreashurst/claude-docker${NC}"
echo ""
echo -e "${MAGENTA}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${NC}"
echo ""
