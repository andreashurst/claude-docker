#!/bin/bash
# Environment detection with DDEV/Vite awareness

# Check for DDEV
if [ -f /var/www/html/.ddev/config.yaml ]; then
    echo "DDEV"
    if [ -f /var/www/html/.ddev/config.yaml ]; then
        SITENAME=$(grep '^name:' /var/www/html/.ddev/config.yaml | sed 's/name: *//' | tr -d '"')
        echo "  Project: $SITENAME"
    fi
# Check for Docker
elif [ -f /.dockerenv ]; then
    echo "Docker"
    # Check for Vite dev server
    for port in 5173 3000 4173; do
        if timeout 1 bash -c "</dev/tcp/host.docker.internal/$port" 2>/dev/null; then
            echo "  Vite detected on port $port"
        fi
    done
# Kubernetes
elif [ -n "$KUBERNETES_SERVICE_HOST" ]; then
    echo "Kubernetes"
# Local
else
    echo "Local"
    # Check for local Vite
    for port in 5173 3000 4173; do
        if timeout 1 bash -c "</dev/tcp/localhost/$port" 2>/dev/null; then
            echo "  Vite detected on port $port"
        fi
    done
fi